// Comprehensive ownership and borrowing demonstration

import @firescript/std.io.{println};

// =============================================================================
// 1. COPYABLE CLASS - annotated with 'copyable'
// =============================================================================
copyable class Vec2 {
    float32 x;
    float32 y;
}

// =============================================================================
// 2. OWNED CLASS - default for user-defined classes
// =============================================================================
class Point {
    int32 x;
    int32 y;
}

// =============================================================================
// 3. BORROWED PARAMETER (&T) - read-only access, doesn't take ownership
// =============================================================================
int32 distanceSquared(&Point p) {
    return p.x * p.x + p.y * p.y;
}

// =============================================================================
// 4. PARAMETER - takes ownership, invalidates caller's binding
// =============================================================================
void destroyPoint(Point p) {
    println(p.x);
    // p is dropped when function returns
}

// =============================================================================
// DEMONSTRATION
// =============================================================================

// Copyable types: copy on assignment, no move semantics
Vec2 v1 = Vec2(1.0f32, 2.0f32);
Vec2 v2 = v1;  // Copy - v1 is still valid
println(v1.x);  // Works! v1 wasn't moved
println(v2.x);  // Also works

// Owned types: move on assignment
Point p1 = Point(10i32, 20i32);
Point p2 = p1;  // Move - p1 is now INVALID
// println(p1.x);  // Would cause: Use-after-move error
println(p2.x);  // OK - p2 owns the value

// Borrowed parameters: temporary read-only access
Point p3 = Point(3i32, 4i32);
int32 dist = distanceSquared(p3);  // Borrow - p3 is still valid after call
println(dist);
println(p3.x);  // OK - p3 wasn't moved, just borrowed

// Owned parameters: ownership transfer
Point p4 = Point(7i32, 8i32);
destroyPoint(p4);  // Move - p4 is now INVALID
// println(p4.x);  // Would cause: Use-after-move error

println(999i32);  // Test completed successfully!
